포트리스(2D 탄도 슈팅) 게임 요구사항 정의서 v2.0 — Final Baseline

1) 개요
브라우저에서 실행되는 단일 HTML 기반의 2D 포트리스 게임. 캔버스로 렌더링하고, 물리/탄도/지형 파괴/바람/무기 시스템을 포함한다. jQuery는 HUD·옵션 바인딩 및 DOM 이벤트 단순화에 사용한다.

2) 범위
[포함]
- 단일 파일(HTML) 안에 스타일·자바스크립트 포함
- Canvas 2D 렌더링(외부 엔진 불사용), jQuery 3.7.x 활용
- 파괴형 지형, 풍속 적용 탄도, 5종 무기, 2인 로컬 턴제
- 실사풍 탱크 스프라이트(코드 드로잉), 궤적 점선 미리보기, 폭발 이펙트
- HUD/옵션 패널(바람 on/off, 친선피해, 저사양 이펙트)
- 미니맵, 턴 타이머, 라운드 메시지(3초 후 자동 숨김)
[제외]
- 온라인 멀티, 서버 저장, 모바일 전용 최적화(선택)

3) 기술 스택
- 런타임: 최신 크롬/엣지/파이어폭스(데스크톱)
- 렌더링: HTML5 Canvas 2D
- UI 보조: jQuery 3.7.x (CDN; 개발 단계 SRI 미사용 권장)
- 에셋: 탱크/포탑/포신은 오프스크린 캔버스에 코드로 그려서 텍스처화(외부 이미지 無)

4) 게임 진행(턴 루프)
1. 이동 단계(현재 플레이어, 제한 시간 20s): 좌/우 이동 및 방향 전환(연료 소모)
2. 조준/발사: 각도·파워 조정 → 발사 1회 → 투사체 시뮬레이션 종료 시 턴 종료
3. 턴 전환: P1 ↔ P2 순환, 바람 재롤링
4. 라운드 종료: 한쪽 HP 0 또는 낙사 시 승리 확정 → 메시지 표시 후 1초 뒤 재시작

5) 컨트롤
- P1 이동: A(좌)/D(우), 발사: Space
- P2 이동: ←/→, 발사: ' (apostrophe)
- 각도/파워 슬라이더: 하단 HUD(마우스 조작 기준)
  * 각도 슬라이더는 키보드 입력 차단(움직임 키와 충돌 방지)
- 기본 방향: P1 → 오른쪽, P2 → 왼쪽(초기 dir = -1)

6) 탱크(비주얼 & 물리)
- 사이즈: 차체 W=84, H=40, 포신 길이≈50(실제는 포탑 스프라이트 배럴 기준)
- 리얼 텍스처: 차체(트랙·로드휠·차체 음영), 포탑/포신(금속 그라디언트) — 미러링으로 좌우 방향 지원
- 포탑 회전 규칙(최종본 핵심)
  * 방향과 무관하게 위쪽을 기준으로 각도 θ: rotate(-θ)로 통일
  * 발사 벡터: x = dir * cos(θ), y = -sin(θ)
- 지면 접지: x위치의 지면 높이를 스캔하여 탱크 y를 보정

7) 무기 시스템
- 공통: 각도(0~90°), 파워(10~100), 바람 가속 영향, 중력 900 px/s²
- 발사 속도: speed = lerp(280, 880, power/100) (최종본: 비거리 상향)
- 종류(5종)
  * HE: 반경 36 / 피해 60 / 크레이터 34
  * AP: 반경 18 / 피해 85 / 크레이터 10 / 관통(지형 약)
  * CL(클러스터): splitTime 0.6s 후 자탄 5개 분리
  * DR(드릴): 지면 접촉 후 지연 폭발(0.35s)
  * BO(바운스): 최대 2회 바운스(e=0.55) 후 폭발
- 친선피해 토글: 끔일 때 자기탄 피격 무시
- 궤적 예측 점선: 발사 전 현재 각도·파워·바람 기준 점열 표시

8) 지형(파괴형)
- 생성: 사인 웨이브 합성으로 기저 곡면 생성 + 잔디 캡 라인
- 파괴: 폭발 시 destination-out로 원형 마스크 삭제(라디얼 그라디언트 가장자리 소프트닝)
- 충돌 판정: 픽셀 알파 샘플링으로 고체 여부 판정(간편·빠름)
- 미니맵: 지형 알파를 저해상도 샘플링하여 표시 + 탱크 포지션 점

9) 바람(풍속)
- 범위: [-20, +20] m/s
- 적용: 수평 가속으로 투사체에 매 프레임 적용(windAccel = wind * 18)
- 표시: 상단 HUD에 방향 화살표(좌/우 회전) + 수치

10) HUD / 옵션
- 상단: HP(P1/P2), 스코어, 바람, 턴 타이머
- 하단: 각도·파워 슬라이더, 무기 선택 5종 버튼, FIRE 버튼, 미니맵
- 옵션: 친선피해, 바람 사용, 저사양 이펙트
- 라운드/승리 메시지: 중앙 팝업 3초 후 자동 숨김

11) 이펙트 & 최적화
- 폭발 파티클(라이트/애드블렌드), 서브탄, 스크린 셰이크
- 객체 풀링: 파편·서브탄(배열 재사용) / 최대 파티클 상한 320
- 저사양 모드: 파티클 수 축소
- 오프스크린 연산 최소화: 궤적 샘플 수 제한, 화면 밖 투사체 제거

12) 데이터/상수(최소 세트)
- GRAVITY: 900 px/s²
- WIND_MAX: ±20 m/s
- TURN_TIME: 20 s
- SPEED_RANGE: 280~880 px/s
- TANK_W/H: 84×40 px
- CRATER_RADIUS: 무기별

13) 수용 기준 (Acceptance)
1. 단일 HTML 파일만으로 실행(브라우저에서 로컬 열기)
2. P2는 시작 시 왼쪽(dir=-1) 바라봄 — 시각적으로 확인 가능
3. 각도·파워 조정 → 궤적 점선이 바람을 반영하여 예측됨
4. 발사 후 투사체 종료/자탄 처리 완료 시 턴 자동 종료
5. 5종 무기의 동작이 명세대로(관통/분열/드릴/바운스 등) 체감됨
6. 폭발 시 지형이 시각적으로 파괴되고, 탱크가 낙하 가능
7. HUD: 바람 방향/수치, HP/스코어/타이머가 즉시 갱신
8. 라운드 시작/승리 메시지가 3초 후 자동 사라짐
9. 저사양 모드에서 파티클 감소로 체감 성능 개선
10. 일반 PC 환경에서 50~60 FPS 유지(지형 파괴 연속 상황 제외)

14) 테스트 시나리오
- 기본 방향성: 시작 직후 P2 포탑이 왼쪽을 향하는지 확인
- 각도 슬라이더: 화살표키 입력 시 슬라이더 값이 변하지 않음(마우스만)
- 무기별 동작: HE/AP/CL/DR/BO 각각 3회씩 발사하여 효과 검증
- 바람 영향: 0/±10/±20에서 궤적 편차 관찰(예측 점선과 낙차 일치 여부)
- 지형 파괴 & 낙사: 연속 폭발로 발밑 제거 → 낙하 → HP 0 처리
- 턴 타이머: 조작 없이 대기 시 20s 후 자동 턴 전환
- 메시지 UI: “NEW ROUND”, “PLAYER X WINS!”가 3초 후 사라짐
- 성능: 저사양 토글 on/off로 파티클 수 변화·FPS 비교

15) 에러 처리 & 안정성
- 키 충돌 회피: 각도 슬라이더의 키보드 입력 차단
- 중복 선언 방지: 전역 객체(sprites, screenShake 등) 단일 정의
- 경계 처리: 화면 밖 투사체 즉시 제거, 자탄 카운트 0이 되면 턴 종료
- CDN 실패: jQuery 로드 실패 시 안내(선택), 개발 단계 SRI 생략

16) 접근성 & UX
- 높은 대비의 HUD, 큰 버튼
- 직관적 슬라이더·무기 버튼, 궤적 미리보기 제공